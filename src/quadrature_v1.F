C-----------------------------------------------------------------------
C
C     Subroutine QUADRATURE
C
C     Written by Ethan Kubatko (02-05-2010)
C
C     This subroutine returns the weights and points of a D degree
C     quadrature rule for a given region.  Regions may be one of the
C     following:
C
C       EDGE:       -1 <= X <= 1
C       TRIANGLE:   -1 <= X =< 1, -1 <= Y < 1,  X + Y <= 0
C       SQUARE:     -1 <= X =< 1, -1 <= Y < 1,
C       TRIPRISM:   -1 <= X <= 1, -1 <= Y <= 1, -1 <= Z <= 1, X + Y <= 0
C
C     Edge rules are standard Gauss-Legendre rules.  The remaining rules
C     are obtained from a number of different sources listed below. The
C     references for particular rules are noted below.
C
C-----------------------------------------------------------------------
C
C     Input:
C     ------
C       D:       Polynomial degree of rule
C       REGION:  EDGE, TRIANGLE, SQUARE, or TRIPRISM (prism with a tri-
C                angular base)
C
C     Output:
C     -------
C       PTS: Array of quadrature points of size QUAD_PTS by DIM where
C            QUAD_PTS is the number of points for a given rule and DIM
C            (=1 ,2, or 3) is the dimension of the region.
C       WTS: Array of quadrature weights of size QUAD_PTS by 1.
C
C-----------------------------------------------------------------------

      SUBROUTINE QUADRATURE( D, REGION, PTS, WTS, N, SZ2, SZ3 )
      USE SIZES

      IMPLICIT NONE

C.....Declare subroutine input and output

      INTEGER :: D, SZ2, SZ3
      CHARACTER(LEN = 8) :: REGION
      INTEGER :: N
      REAL(SZ) :: PTS(SZ2,SZ3)
      REAL(SZ) :: WTS(SZ2)

      INTEGER :: I, J, K, L
      REAL(SZ) :: AREA
      REAL(SZ) :: V1(2), V2(2), V3(2)
      REAL(SZ), ALLOCATABLE :: A(:), B(:), C(:), M(:), W(:)

C-----------------------------------------------------------------------
C                        EDGE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     Notes: (1) These are standard Gauss-Legendre rules.
C            (2) An n point Gauss-Legendre quadrature rule will
C                integrate up to a 2n-1 degree polynomial exactly.
C
C-----------------------------------------------------------------------

      IF (REGION == 'EDGE    ') THEN
        N = CEILING((D+1)/2.)
        L = CEILING(N/2.)
C-----------------------------------------------------------------------
        IF (D.LE.1) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = 0.000000000000000  ! Point
          WTS(1)   = 1.000000000000000  ! Weight
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.577350269189630  ! Points
          WTS(1)   =  1.00000000000000  ! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.774596669241480  ! Points
          PTS(2,1) =  0.00000000000000
          WTS(1)   =  0.555555555555560  ! Weights
          WTS(2)   =  0.888888888888880
C-----------------------------------------------------------------------
        ELSEIF (D.LE.7) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.861136311594050  ! Points
          PTS(2,1) = -0.339981043584860
          WTS(1)   =  0.347854845137450  ! Weights
          WTS(2)   =  0.652145154862550
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.906179845938660  ! Points
          PTS(2,1) = -0.538469310105680
          PTS(3,1) =  0.00000000000000
          WTS(1)   =  0.236926885056190  ! Weights
          WTS(2)   =  0.478628670499370
          WTS(3)   =  0.568888888888890
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.932469514203150  ! Points
          PTS(2,1) = -0.661209386466260
          PTS(3,1) = -0.23861918608320
          WTS(1)   =  0.171324492379170  ! Weights
          WTS(2)   =  0.360761573048140
          WTS(3)   =  0.467913934572690
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.949107912342760  ! Points
          PTS(2,1) = -0.741531185599390
          PTS(3,1) = -0.40584515137740
          PTS(4,1) =  0.0
          WTS(1)   =  0.129484966168870  ! Weights
          WTS(2)   =  0.279705391489280
          WTS(3)   =  0.381830050505120
          WTS(4)   =  0.417959183673470
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.960289856497540  ! Points
          PTS(2,1) = -0.796666477413630
          PTS(3,1) = -0.525532409916330
          PTS(4,1) = -0.183434642495650
          WTS(1)   =  0.101228536290380  ! Weights
          WTS(2)   =  0.222381034453370
          WTS(3)   =  0.313706645877890
          WTS(4)   =  0.362683783378360
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.968160239507630  ! Points
          PTS(2,1) = -0.836031107326640
          PTS(3,1) = -0.613371432700590
          PTS(4,1) = -0.324253423403810
          PTS(5,1) =  0.00000000000000
          WTS(1)   =  0.081274388361630  ! Weights
          WTS(2)   =  0.180648160694830
          WTS(3)   =  0.260610696402940
          WTS(4)   =  0.31234707704000
          WTS(5)   =  0.330239355001260
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.973906528517170! Points
          PTS(2,1) = -0.865063366688980
          PTS(3,1) = -0.679409568299020
          PTS(4,1) = -0.433395394129250
          PTS(5,1) = -0.148874338981630
          WTS(1)   =  0.066671344308690  ! Weights
          WTS(2)   =  0.149451349150580
          WTS(3)   =  0.219086362515980
          WTS(4)   =  0.26926671931000
          WTS(5)   =  0.295524224714750
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.978228658146060  ! Points
          PTS(2,1) = -0.88706259976810
          PTS(3,1) = -0.730152005574050
          PTS(4,1) = -0.519096129206810
          PTS(5,1) = -0.269543155952340
          PTS(6,1) =  0.00000000000000
          WTS(1)   =  0.055668567116270  ! Weights
          WTS(2)   =  0.125580369464850
          WTS(3)   =  0.186290210927740
          WTS(4)   =  0.233193764591990
          WTS(5)   =  0.262804544510250
          WTS(6)   =  0.27292508677790
C-----------------------------------------------------------------------
        ELSEIF (D.LE.23) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.981560634246720 ! Points
          PTS(2,1) = -0.904117256370470
          PTS(3,1) = -0.76990267419430
          PTS(4,1) = -0.587317954286620
          PTS(5,1) = -0.367831498998180
          PTS(6,1) = -0.125233408511470
          WTS(1)   =  0.047175336386770  ! Weights
          WTS(2)   =  0.10693932599520
          WTS(3)   =  0.160078328543340
          WTS(4)   =  0.203167426723080
          WTS(5)   =  0.233492536538350
          WTS(6)   =  0.24914704581340
C-----------------------------------------------------------------------
        ELSEIF (D.LE.25) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.984183054718590  ! Points
          PTS(2,1) = -0.917598399222980
          PTS(3,1) = -0.801578090733310
          PTS(4,1) = -0.642349339440340
          PTS(5,1) = -0.448492751036450
          PTS(6,1) = -0.230458315955130
          PTS(7,1) =  0.00000000000000
          WTS(1)   =  0.040484004765320  ! Weights
          WTS(2)   =  0.092121499837730
          WTS(3)   =  0.138873510219790
          WTS(4)   =  0.178145980761950
          WTS(5)   =  0.207816047536890
          WTS(6)   =  0.22628318026290
          WTS(7)   =  0.232551553230870
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          call quad_rules_general(N, .false., 0.0, 0.0, pts, wts)
        
        ENDIF
C-----------------------------------------------------------------------
        J = MOD(N,2)
        DO I = L,N
          PTS(I+1,1) = -PTS(L-J,1)
          WTS(I+1)   =  WTS(L-J)
          J = J + 1
        ENDDO
C-----------------------------------------------------------------------
C                        TRIANGLE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights with all points located inside the
C     triangle (so-called PI rules). Rules marked by * are optimal.
C
C     References:

C     [1] D.A. Dunavant, "High Degree Efficient Symmetrical Gaussian
C         Quadrature Rules for the Triangle", International Journal for
C         Numerical Methods in Engineering, 21, 1129--1148, 1985.
C
C     [2] L. Zhang, T. Cui, and Hui Liu, "A Set of Symmetric Quadrature
C         Rules on Triangles and Tetrahedra", Journal of Computational
C         Mathematics, 27, 89--96, 2009.
C
C     [3] P. Hillion, "Numerical Integration on a triangle",
C         International Journal for Numerical Methods in Engineering,
C         11, 797--815, 1977.
C
C     [4] K. Gatermann, "The construction of symmetric cubature formulas
C         for the square and the triangle, Computing, 40, 229--240,
C         1988.
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'TRIANGLE') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1 /)                                     ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330 /)! Points
          W(1:L) = (/ 1.0000000000000000000000000000000000 /)! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3 /)                                     ! Multip.
          A(1:L) = (/ 0.16666666666666666666666666666666660 /)! Points
          W(1:L) = (/ 0.33333333333333333333333333333333330 /)! Weights
C-----------------------------------------------------------------------
c        ELSEIF (D.LE.3) THEN                                  ! Ref [3]*
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
        ELSEIF (D.LE.4) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 2
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3 /)                                   ! Multip.
          A(1:L) = (/ 0.44594849091596488631832925388305190,  ! Points
     &                0.09157621350977074345957146340220150 /)
          W(1:L) = (/ 0.22338158967801146569500700843312280,  ! Weights
     &                0.10995174365532186763832632490021050 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3 /)                                 ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.47014206410511508977044120951344760,
     &                0.10128650732345633880098736191512380 /)
          W(1:L) = (/ 0.2250000000000000000000000000000000,  ! Weights
     &                0.13239415278850618073764938783315190,
     &                0.12593918054482715259568394550018130 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.6) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,6 /)                                 ! Multip.
          A(1:L) = (/ 0.06308901449150222834033160287081920,  ! Points
     &                0.24928674517091042129163855310701910,
     &                0.05314504984481694735324967163139810 /)
          B(3:3) = (/ 0.31035245103378440541660773395655220 /)
          W(1:L) = (/ 0.0508449063702068169209368091068690,  ! Weights
     &                0.11678627572637936602528961138557940,
     &                0.08285107561837357519355345642044250 /)
C-----------------------------------------------------------------------
c        ELSEIF (D.LE.7) THEN                                  ! Ref [4]*
C-----------------------------------------------------------------------
C          L = 4
C          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
C          M(1:L) = (/ 3,3,3,3 /)
C          A(1:L) = (/ /)
C          B(1:L) = (/ /)
C          W(1:L) = (/ /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.8) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 5
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,6 /)                             ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.17056930775176020662229350149146450,
     &                0.05054722831703097545842355059659890,
     &                0.45929258829272315602881551449416930,
     &                0.26311282963463811342178578628464360 /)
          B(5:5) = (/ 0.00839477740995760533721383453929440 /)
          W(1:L) = (/ 0.14431560767778716825109111048906460,  ! Weights
     &                0.1032173705347182502817915502921290,
     &                0.03245849762319808031092592834178060,
     &                0.09509163426728462479389610438858430,
     &                0.02723031417443499426484469007390890 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6 /)                           ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.48968251919873762778370692483619280,
     &                0.04472951339445270986510658996627640,
     &                0.4370895914929366372699303644353550,
     &                0.18820353561903273024096128046733560,
     &                0.74119859878449802069007987352342380 /)
          B(6:6) = (/ 0.22196298916076569567510252769319110 /)
          W(1:L) = (/ 0.09713579628279883381924198250728860,  ! Weights
     &                0.03133470022713907053685483128720930,
     &                0.02557767565869803126167879855899980,
     &                0.0778275410047742793167393562994040,
     &                0.07964773892721025303289177426404530,
     &                0.04328353937728937728937728937728940 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.10) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 7
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6,6 /)                         ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.42727317884677553809044271751544720,
     &                0.1830992224486750205215743848502200,
     &                0.49043401970113058745397122237684840,
     &                0.01257244555158053273132908502104130,
     &                0.65426866792006614066657009558762790,
     &                0.12280457706855927343012981748128120 /)
          B(6:7) = (/ 0.3080460016852477000000000000000000,
     &                0.03337183373930478624081644177478040 /)
          W(1:L) = (/ 0.08093742879762288025711312381650190,  ! Weights
     &                0.07729858800296312168250698238034340,
     &                0.07845763861237173136809392083439670,
     &                0.01746916799592948691760716329067810,
     &                0.00429237418483282803048040209013190,
     &                0.03746885821046764297902076548504450,
     &                0.02694935259187995964544947958109670 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 8
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,6,6 /)                       ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.03093835524543078489519501499130470,
     &                0.43649818113412884191761527655997320,
     &                0.49898476370259326628798698383139090,
     &                0.21468819795859433660687581387825090,
     &                0.11368310404211339020529315622836180,
     &                0.8256187661648629043588062003083580,
     &                0.64047231013486526767703659081896680 /)
          B(7:8) = (/ 0.15974230459185018980086078822500750,
     &                0.3117837157095990000000000000000000 /)
          W(1:L) = (/ 0.08117796029686715951547596874982360,
     &                0.01232404350690949411847390101623280,  ! Weights
     &                0.0628280097444101072833394281602940,
     &                0.01222037904936452975521221500393790,
     &                0.06770134895281150992098886182322560,
     &                0.04021969362885169042356688960756870,
     &                0.01476227271771610133629306558778210,
     &                0.04072799645829903966033695848161790 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.12) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 8
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,3,6,6,6 /)                       ! Multip.
          A(1:L) = (/ 0.02131735045321037024685697551572820,  ! Points
     &                0.27121038501211592234595134039689470,
     &                0.12757614554158592467389632515428360,
     &                0.43972439229446027297973662348436110,
     &                0.4882173897738048825646620652588110,
     &                0.69583608678780342214163552323607250,
     &                0.85801403354407263059053661662617820,
     &                0.60894323577978780685619243776371010 /)
          B(6:8) = (/ 0.28132558098993954824813069297455270,
     &                0.11625191590759714124135414784260180,
     &                0.2757132696855141939747963460797640 /)
          W(1:L) = (/ 0.00616626105155901723386648378523040,  ! Weights
     &                0.06285822421788510035427051309288250,
     &                0.03479611293070894298932839729499940,
     &                0.0436925445380384021354572625574750,
     &                0.02573106644045533541779092307156440,
     &                0.0223567732023034457118390767023200,
     &                0.01731623110865889237164210081103410,
     &                0.04037155776638092951782869925223680 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 9
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6,6,6,6 /)                     ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.42694141425980040602081253503137420,
     &                0.22137228629183290065481255470507910,
     &                0.02150968110884318386929131353405210,
     &                0.48907694645253934990068971909020440,
     &                0.62354599555367557081585435318623660,
     &                0.86470777029544277530254595089569320,
     &                0.74850711589995219517301859578870970,
     &                0.7223577931241879652606201323047840 /)
          B(6:9) = (/ 0.30844176089211777465847185254124530,
     &                0.11092204280346339541286954522167450,
     &                0.16359740106785048023388790171095720,
     &                0.27251581777342966618005046435408680 /)
          W(1:L) = (/ 0.06796003658683164428177442468088490,
     &                0.05560196753045332870725746601046150,  ! Weights
     &                0.05827848511919998140476708351333980,
     &                0.00605233710353917184179280003229080,
     &                0.02399440192889473077371079945095970,
     &                0.03464127614084837046598682851091820,
     &                0.01496540110516566726324585713290340,
     &                0.02417903981159381913744574557306080,
     &                0.00959068100354326272259509016611090 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.14) THEN                                 ! Ref [1]
C-----------------------------------------------------------------------
          L = 10
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,3,3,6,6,6,6 /)                 ! Multipl.
          A(1:L) = (/ 0.48896391036217900000000000000000,    ! Points
     &                0.41764471934045400000000000000000,
     &                0.27347752830883900000000000000000,
     &                0.17720553241254300000000000000000,
     &                0.06179988309087300000000000000000,
     &                0.01939096124870100000000000000000,
     &                0.17226668782135600000000000000000,
     &                0.33686145979634500000000000000000,
     &                0.29837288213625800000000000000000,
     &                0.11897449769695700000000000000000 /)
          B(7:L) = (/ 0.77060855477499600000000000000000,
     &                0.57022229084668300000000000000000,
     &                0.68698016780808800000000000000000,
     &                0.87975717137017100000000000000000 /)
          W(1:L) = (/ 0.02188358136942900000000000000000,    ! Weights
     &                0.03278835354412500000000000000000,
     &                0.05177410450729200000000000000000,
     &                0.04216258873699300000000000000000,
     &                0.01443369966977700000000000000000,
     &                0.00492340360240000000000000000000,
     &                0.02466575321256400000000000000000,
     &                0.03857151078706100000000000000000,
     &                0.01443630811353400000000000000000,
     &                0.00501022883850100000000000000000 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 13
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,3,6,6,6,6,6 /)             ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.22733221881914287420250436849229410,
     &                0.49716257743188742987380980001602330,
     &                0.47884973534895458333922920014385260,
     &                0.4049860390982719916972446423426920,
     &                0.0159312166717444321134277329412690,
     &                0.1655832624260814000000000000000000,
     &                0.07313360471922872772687381210732440,
     &                0.66526073307221393906236441338569120,
     &                0.71252198724254553304884901162338780,
     &                0.5596483622353932184122484540192300,
     &                0.81047659761907686304683273029057130,
     &                0.9160756440317311885646088387783200 /)
          B(9:L) = (/ 0.31635283934494723008633813095024530,
     &                0.09346075114991753000000000000000050,
     &                0.34422901758219320000000000000000160,
     &                0.17104724831425795154765033192558480,
     &                0.0730559964791864896129490819274250 /)
          W(1:L) = (/ 0.04403871087843427985301732721493390,  ! Weights
     &                0.04618478718202697994871566760191670,
     &                0.00649890661733271652688280349281020,
     &                0.01799361425265840324466992416715660,
     &                0.0417731050391413541196860605641460,
     &                0.00305954760911646654843016992834480,
     &                0.00201243505255864734409031875654050,
     &                0.01677561093050912232611145688795880,
     &                0.01546074918971427486608803040924740,
     &                0.0284998903395474233927395587533020,
     &                0.03209435048348959564209923573709570,
     &                0.01150858163687071128402324377324190,
     &                0.00461430652896710314358717609185410 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.16) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 13
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6 /)             ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.0817949831313738726414655931188610,
     &                0.16530060196977965062676193293355660,
     &                0.46859210534946138669460289729660560,
     &                0.01443881344541668261410895669566020,
     &                0.24178428539178335340689445929320770,
     &                0.49531034298776996406549508687740550,
     &                0.65051340266135229943114468484168670,
     &                0.6040112814959970398494041030359670,
     &                0.80216825757474166361686194781166710,
     &                0.75650560644282839655115407575806080,
     &                0.46593843871411818488381073359154640,
     &                0.9063948439920415013624996618653400 /)
          B(8:L) = (/ 0.33139974453708955658132316818259390,
     &                0.30324716274994218504155217807834690,
     &                0.18802805952123717344418211429398880,
     &                0.18350466852229686368238027743700040,
     &                0.3596459487975046000000000000000100,
     &                0.07719437129575543228251522505271390 /)
          W(1:L) = (/ 0.04802218868037709055183940458051990,  ! Weights
     &                0.01470910030680192710340364286186920,
     &                0.02954458654931925599530972679646410,
     &                0.02612501735108837749859756549171560,
     &                0.00278038735239000697500301613866210,
     &                0.03182177300053664950342729005594960,
     &                0.00864583434950965990117373416984890,
     &                0.01430033290449536514661642536825210,
     &                0.02784977720360082995222987342395350,
     &                0.00704167340663609756237018808928070,
     &                0.01789983825993372860177020907581080,
     &                0.02745820038434976307247003810091720,
     &                0.00729979693943176208411254408777770 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6,6 /)           ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.09569850886271093994316257860237630,
     &                0.17013863967877544672324723079568440,
     &                0.41802068586795497622263464239342780,
     &                0.49658148050662495497054035306227920,
     &                0.04166211482880764279207885159834190,
     &                0.46793290572942357826819008536171190,
     &                0.96953119890372205619454058305953240,
     &                0.75972438753862412955532719532266120,
     &                0.2954993169683015000000000000000100,
     &                0.6256063821576970270701920926669370,
     &                0.87217444723318479290318300141560740,
     &                0.74751231944000604006240678176087530,
     &                0.5988687908832380598061676972635110 /)
          B(8:L) = (/ 0.02892509162021824607152804771406820,
     &                0.23444175526356877454266053091297880,
     &                0.49591124666075357542303450004375520,
     &                0.35341769454149706762632499077099380,
     &                0.1127286418142197686188888676807420,
     &                0.19907027879785788131339143981558310,
     &                0.30358518307132607653202051204584940  /)
          W(1:L) = (/ 0.04475687144434462937183647670425510,  ! Weights
     &                0.01736688502674779645049111764776040,
     &                0.0305993480761035327226656472689570,
     &                0.02858770857859978020704009121768920,
     &                0.00664743192975369323231849554546680,
     &                0.0074761894020185118222455734708010,
     &                0.02504998650383874531455895190550780,
     &                0.00147981089211964494480953682750480,
     &                0.00512113624674810606589435040573260,
     &                0.02731735936959280591853168984239570,
     &                0.01400572867590928159786633211401180,
     &                0.0078092756974583600981098732328800,
     &                0.01816572845979167217607207751722370,
     &                0.02744437399245832776208345541478450 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.18) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,6,6,6,6,6,6,6,6,6,6 /)         ! Multipl.
          A(1:L) = (/ 0.07327088646438283157861967148768950,  ! Points
     &                0.00391774898322823164278407441958060,
     &                0.46759731898871106165151299662296240,
     &                0.41791621096741131201212681051399350,
     &                0.16538169336028948005449026923917660,
     &                0.28750089440578398999619391313966060,
     &                0.1258893143198247960170648399490380,
     &                0.0632219159465026144935750801169980,
     &                0.07891022745402051775207221037548890,
     &                0.03805805350678571432611899159626210,
     &                0.01429035213045402564992411031307490,
     &                0.01296727234325317231234163433009030,
     &                0.00764859482084089933079262881822730,
     &                0.01271046057225546793114249181358220 /)
          B(5:L) = (/ 0.56369670566087075380514589393807370,
     &                0.28604232613920474912095810748030290,
     &                0.69604321864246119579257486028195390,
     &                0.76054555188768243261459476379786870,
     &                0.59201963127175856332262057540222540,
     &                0.68368125963599985248012408745381310,
     &                0.85170403713705581502852165344276640,
     &                0.57473249288814902889945093868968970,
     &                0.73551044083072929870313522448164060,
     &                0.93934508764373178870740420268282250 /)
          W(1:L) = (/ 0.01397786164528602097958400799055490,  ! Weights
     &                0.00055490697921321378506845551525090,
     &                0.0210268138197046690284298685162450,
     &                0.03401821217992769974722652741822110,
     &                0.02791016580477499514184347400781690,
     &                0.01821468612715086612673395662068580,
     &                0.01426702365810979307751982410955670,
     &                0.0142371230906750507043127637741560,
     &                0.01925758385467478779913738368202130,
     &                0.00970513228438064114878227633239020,
     &                0.00762978813433212899578245563385340,
     &                0.01061873913635034479446354367052830,
     &                0.00571066980327583881341421438268950,
     &                0.00432685746087641829452234473283270 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 17
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L)  = (/ 1,3,3,3,3,3,3,3,3,6,6,6,6,6,6,6,6 /)    ! Multip.
          A(1:L)  = (/ 0.33333333333333333333333333333333330, ! Points
     &                 0.48960998707300633196613106574829820,
     &                 0.45453689269789266204675939053572830,
     &                 0.40141668064943118739399562381068860,
     &                 0.25555165440309761132218176810926790,
     &                 0.17707794215212955164267520651590110,
     &                 0.1100610532279518613000849516773740,
     &                 0.05552862425183967124867841247135570,
     &                 0.0126218637772286684902347667787060,
     &                 0.6006337947946450000000000000000000,
     &                 0.13446675453077978561204319893264690,
     &                 0.72098702581736505521665290233827890,
     &                 0.59452706895587092461388928802650670,
     &                 0.83933147368083857861749007714840520,
     &                 0.22386142409791569130336938950653640,
     &                 0.82293132406985663162747155916053320,
     &                 0.92434425262078402945585913790156310 /)
          B(10:L) = (/ 0.39575478735694286230479469406582790,
     &                 0.5576032615887839683639532425011810,
     &                 0.26456694840652020804030173490121490,
     &                 0.35853935220595058842492699064590090,
     &                 0.15780740596859474473767360335950650,
     &                 0.70108797892617336732328833655951160,
     &                 0.14242160111338343731557475687723740,
     &                 0.06549462808293770339232652498592560 /)
          W(1:L)  = (/ 0.0329063313889186520836143448464750, ! Weights
     &                 0.01033073189127205336703996357174830,
     &                 0.02238724726301639252918455603516270,
     &                 0.03026612586946807086528019098259120,
     &                 0.03049096780219778100003158657852040,
     &                 0.0241592127416409049118480309866400,
     &                 0.01605080358680087529162277027642950,
     &                 0.00808458026178406048180567324219440,
     &                 0.00207936202748478075134750167439840,
     &                 0.00388487690498138975670499199277270,
     &                 0.02557416061202190389292970195260030,
     &                 0.00888090357333805774552592470351750,
     &                 0.01612454676173139121978526932783770,
     &                 0.00249194181749067544058464757594960,
     &                 0.01824284011895057837766571320973610,
     &                 0.01025856373619852130804807004235810,
     &                 0.00379992885530191397907315371363970 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.20) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 18
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,6,6,6,6,6,6,6,6,6,6,6,6 /)   ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.21587430593299197319025454384018280,
     &                0.07537676652974727809728543094591630,
     &                0.01030082813722179211368621600969690,
     &                0.49360221129870016551192083214505360,
     &                0.4615509381069252967410487102915180,
     &                0.32862140642423699330349746095091330,
     &                0.26048036178656875641959301708115350,
     &                0.1370742358464553000000000000000000,
     &                0.1467269458722997843041609884874530,
     &                0.0269989777425532900000000000000000,
     &                0.06187178593361702684171247001223390,
     &                0.04772436742762199620835268010429340,
     &                0.12060051518636437996723378704007940,
     &                0.00269714779670978767164891450128270,
     &                0.0030156332779423626572762598234710,
     &                0.02990537578845701880692877386433860,
     &                0.00675665422246098853994581751922780 /)
          B(7:L) = (/ 0.42934057025821037521395880046639840,
     &                0.10157753428096944616875500619617970,
     &                0.71006597300113015998790407454640790,
     &                0.49854547767841484938962269670761190,
     &                0.04918672267258200161970371257758720,
     &                0.77966014654056939536035061907681080,
     &                0.37049153914954763692014962025673880,
     &                0.86334694875475264849798799609252170,
     &                0.05619493818774550298789230198658870,
     &                0.20867500674842135095759446306135770,
     &                0.72115124091203409102810415020509410,
     &                0.64005544194054188990405366827216470 /)
          W(1:L) = (/ 0.01253760799449665657358563677239480,  ! Weights
     &                0.02747186987642421374845354960735980,
     &                0.00976527227705142304136469142942370,
     &                0.00139841953539182352392336315978670,
     &                0.0092921026251851826304282034030330,
     &                0.0165778760323669253260236250351840,
     &                0.02066776234866507696142197001297290,
     &                0.02082223552115450730687855619932970,
     &                0.0095686384198490606888758450458320,
     &                0.02445277096897246388564392070240890,
     &                0.00315573063063053400382640032072960,
     &                0.01213679636532129693701330908075740,
     &                0.01496648014388644903652491185157070,
     &                0.00632759332177773956932403275043980,
     &                0.00134256031206369588497985129814330,
     &                0.00277607691634755406772935615580150,
     &                0.01073984447418494155517344744795170,
     &                0.00536780573818745320524741002126970 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 19
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6,6,6,6,6,6,6 /) ! Multip.
          A(1:L) = (/ 0.33333333333333333333333333333333330,  ! Points
     &                0.20093527706508527987296185156416370,
     &                0.43765916596192717973183384418805410,
     &                0.00343395649059617685095991220960490,
     &                0.04664348477530675349517624043214190,
     &                0.38642225176307149094035202416772640,
     &                0.0954354711085309101085716810414760,
     &                0.95551380335045636050131472514677120,
     &                0.88663881342886822612490057469143760,
     &                0.78426284588043415429664399039819540,
     &                0.88292395505020003271134898731688970,
     &                0.66899196444107724049132248320989460,
     &                0.55207212103556096415716096525277880,
     &                0.79759296559656856762931422329572580,
     &                0.67751471511977148463499116634413260,
     &                0.54299741558909160533113611683919340,
     &                0.70545990556996856165885634154060170,
     &                0.5748005730665084622159824505498500,
     &                0.47177880850461481660397704013492420 /)
          B(8:L) = (/ 0.03571862787316335823804160897543870,
     &                0.10814322491564621152738861104631270,
     &                0.20746444959987645682438042951572740,
     &                0.0856847087203169400000000000000100,
     &                0.3214940030142888168816832126834860,
     &                0.4379422187933413835523680769629170,
     &                0.16191645306357785675100677020385910,
     &                0.27450476740199490385900297290733320,
     &                0.40533599807500692794989089537632560,
     &                0.1877376806564353427728167439451200,
     &                0.30569683476605516651279255664984320,
     &                0.31214446687089088167080460581557640 /)
          W(1:L) = (/ 0.02756225695287648096690704482451430,  ! Weights
     &                0.02206021541348850119135073403311640,
     &                0.0234600159386714884930134449523000,
     &                0.00032688959504719054621455750154650,
     &                0.00326531946293996823433530409586670,
     &                0.01175646291541279770430796921338210,
     &                0.01178076841991151684555757909867610,
     &                0.00226881081880114080533570433430430,
     &                0.00259601096443632006067378366548820,
     &                0.00463452978587186021234789056159690,
     &                0.00479433605454885793485744871991190,
     &                0.00571247883672361156725063834296340,
     &                0.00586582760432212163695579870000230,
     &                0.00941376305909158758981826852034710,
     &                0.01341494379665642491002202661089310,
     &                0.01571691809208324594350000113784620,
     &                0.01686368301443690459165096388619990,
     &                0.0213900270853200983778322980803590,
     &                0.02307679218949268136788087552189150 /)
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 21 ********  '
          PRINT*,'  ********      for REGION = TRIANGLE      ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Vertices and area for the master triangular element

        V1   = (/ -1.0, -1.0 /)
        V2   = (/  1.0, -1.0 /)
        V3   = (/ -1.0,  1.0 /)
        AREA = 2.0

C.......Count up number of quadrature points

      N = 0
      DO I = 1,L
        N = N + M(I)
      ENDDO
C      ALLOCATE ( PTS(N,2), WTS(N) )
C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,L
          IF (M(I).EQ.1) THEN
            B(I) = A(I)
            C(I) = B(I)
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            J = J + 1
          ELSEIF (M(I).EQ.3) THEN
            B(I) = A(I)
            C(I) = 1.0 - (A(I) + B(I))
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            PTS(J+1,1) = V1(1)*B(I) + V2(1)*C(I) + V3(1)*A(I)
            PTS(J+1,2) = V1(2)*B(I) + V2(2)*C(I) + V3(2)*A(I)
            WTS(J+1)   = AREA*W(I)
            PTS(J+2,1) = V1(1)*C(I) + V2(1)*A(I) + V3(1)*B(I)
            PTS(J+2,2) = V1(2)*C(I) + V2(2)*A(I) + V3(2)*B(I)
            WTS(J+2)   = AREA*W(I)
            J = J + 3
          ELSEIF (M(I).EQ.6) THEN
            C(I) = 1.0 - (A(I) + B(I))
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            PTS(J+1,1) = V1(1)*B(I) + V2(1)*C(I) + V3(1)*A(I)
            PTS(J+1,2) = V1(2)*B(I) + V2(2)*C(I) + V3(2)*A(I)
            WTS(J+1)   = AREA*W(I)
            PTS(J+2,1) = V1(1)*C(I) + V2(1)*A(I) + V3(1)*B(I)
            PTS(J+2,2) = V1(2)*C(I) + V2(2)*A(I) + V3(2)*B(I)
            WTS(J+2)   = AREA*W(I)
            PTS(J+3,1) = V1(1)*A(I) + V2(1)*C(I) + V3(1)*B(I)
            PTS(J+3,2) = V1(2)*A(I) + V2(2)*C(I) + V3(2)*B(I)
            WTS(J+3)   = AREA*W(I)
            PTS(J+4,1) = V1(1)*B(I) + V2(1)*A(I) + V3(1)*C(I)
            PTS(J+4,2) = V1(2)*B(I) + V2(2)*A(I) + V3(2)*C(I)
            WTS(J+4)   = AREA*W(I)
            PTS(J+5,1) = V1(1)*C(I) + V2(1)*B(I) + V3(1)*A(I)
            PTS(J+5,2) = V1(2)*C(I) + V2(2)*B(I) + V3(2)*A(I)
            WTS(J+5)   = AREA*W(I)
            J = J + 6
          ENDIF
        ENDDO

C-----------------------------------------------------------------------
C                        SQUARE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights (with the exception of rule 23,
C     which has 1 negative weight) with all points located inside the
C     square (so-called PI rules). Rules marked by * are optimal.  The
C     rest are the best PI rules currently known.
C
C     References:

C     [1] A.H. Stroud, "Approximate calculation of multiple integrals",
C         Prentice-Hall, Englewood Cliffs, N.J., 1971.
C
C     [2] J.W. Wissman and T. Becker, "Partially Symmetric Cubature
C         Formulas for Even Degrees of Exactness", SIAM Journal on
C         Numerical Analysis, 23, 676--685, 1986.
C
C     [3] Construction of Cubature Formulas of Degree Seven and Nine
C         Using Symmetric Planar Regions, Using Orthogonal Polynmials",
C         SIAM Journal on Numerical Analysis, 14, 492--508, 1977.
C
C     [4] I.P. Omelyan and V.B. Solovyan, "Improved cubature formulae of
C         high degrees of exactness for the square", Journal of Compu-
C         tational and Applied Mathematics, 188, 190--204, 2006.
C
C     [5] H.M. Moller, "Minimum-Point Cubature Formula", Numerische
C         Mathematik, 25, 185--200, 1976. (in German)
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'SQUARE  ') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1 /)                                ! Multiplicity
          A(1:L) = (/ 0.000000000000000 /)              ! Point
          B(1:L) = (/ 0.000000000000000 /)
          W(1:L) = (/ 4.000000000000000 /)              ! Weight
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1 /)
          A(1:L) = (/ 0.816496580927730,
     &               -0.408248290463860,
     &               -0.408248290463860 /)
          B(1:L) = (/ 0.00000000000000,
     &                0.707106781186550,
     &               -0.707106781186550 /)
          W(1:L) = (/ 1.333333333333330,
     &                1.333333333333330,
     &                1.333333333333330 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4 /)                                ! Multiplicity
          A(1:L) = (/ 0.5773502691896260 /)              ! Points
          B(1:L) = (/ 0.5773502691896260 /)
          W(1:L) = (/ 1.000000000000000 /)              ! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.4) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1 /)                          ! Multipl.
          A(1:L) = (/  0.000000000000000,                   ! Points
     &                 0.000000000000000,
     &                 0.8519146533046010,
     &                 0.6309127889767540,
     &                -0.8519146533046010,
     &                -0.6309127889767540 /)
          B(1:L) = (/  0.000000000000000,
     &                 0.9660917830792960,
     &                 0.4556037278361930,
     &                -0.7316299515731350,
     &                 0.4556037278361930,
     &                -0.7316299515731350 /)
          W(1:L) = (/  1.1428571428571430,                   ! Weights
     &                 0.439560439560440,
     &                 0.5660722070075320,
     &                 0.6427190017836770,
     &                 0.5660722070075320,
     &                 0.6427190017836770 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 7
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1, 1, 1, 1, 1, 1, 1 /)
          A(1:L) = (/  0.00000000000000,
     &                 0.00000000000000,
     &                 0.00000000000000,
     &                 0.774596669241480,
     &                 0.774596669241480,
     &                -0.774596669241480,
     &                -0.774596669241480 /)
          B(1:L) = (/  0.00000000000000,
     &                 0.96609178307930,
     &                -0.96609178307930,
     &                 0.577350269189630,
     &                -0.577350269189630,
     &                 0.577350269189630,
     &                -0.577350269189630 /)
          W(1:L) = (/  1.142857142857140,
     &                 0.317460317460320,
     &                 0.317460317460320,
     &                 0.555555555555560,
     &                 0.555555555555560,
     &                 0.555555555555560,
     &                 0.555555555555560 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.6) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 10
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1,1,1,1,1 /)
          A(1:L) = (/    0.000000000000000,
     &                   0.000000000000000,
     &                   0.8887640146547650,
     &                   0.6048576394646850,
     &                   0.9554475066410640,
     &                   0.5654599934387540,
     &                  -0.8887640146547650,
     &                  -0.6048576394646850,
     &                  -0.9554475066410640,
     &                  -0.5654599934387540 /)
          B(1:L) =  (/   0.8364056336976260,
     &                  -0.3574601653913070,
     &                   0.8721015311931310,
     &                   0.3059851621554270,
     &                  -0.4102708994666580,
     &                  -0.8728693111568790,
     &                   0.8721015311931310,
     &                   0.3059851621554270,
     &                  -0.4102708994666580,
     &                  -0.8728693111568790 /)
          W(1:L) =  (/   0.4553432457141740,
     &                   0.8273959732029660,
     &                   0.1440008845996450,
     &                   0.6682591042626650,
     &                   0.2254740048906790,
     &                   0.3208963967884410,
     &                   0.1440008845996450,
     &                   0.6682591042626650,
     &                   0.2254740048906790,
     &                   0.3208963967884410 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.7) THEN                                  ! Ref [3]*
C-----------------------------------------------------------------------
          L = 4
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 2,2,2,2 /)                          ! Multiplicity
          A(1:L) = (/ 0.917117822312770586260,           ! Points
     &                0.61126876646532841440,
     &                0.529422802042655325890,
     &                0.00000000000000000000 /)
          B(1:L) = (/ 0.547931206828092323770,
     &                0.938843256658858304590,
     &                0.00000000000000000000,
     &                0.627041373780395317630 /)
          W(1:L) = (/ 0.213057211620949126510,           ! Weights
     &                0.17400948894689560610,
     &                0.635853883443279771820,
     &                0.590012715421030762970 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.8) THEN                                  ! Ref [2]
C-----------------------------------------------------------------------
          L = 16
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 /)
          A(1:L) = (/   0.000000000000000,
     &                  0.000000000000000,
     &                  0.000000000000000,
     &                  0.000000000000000,
     &                  0.9066623161021710,
     &                  0.5603481276698430,
     &                  0.5186958562995470,
     &                  0.8392675253163980,
     &                  0.5538327242734490,
     &                  0.342287447682940,
     &                 -0.9066623161021710,
     &                 -0.5603481276698430,
     &                 -0.5186958562995470,
     &                 -0.8392675253163980,
     &                 -0.5538327242734490,
     &                 -0.342287447682940 /)
          B(1:L) = (/   0.000000000000000,
     &                  0.9533211755218070,
     &                 -0.8824580989001260,
     &                  0.5823341881204990,
     &                  0.2945924443337410,
     &                 -0.7712530320946440,
     &                  0.713923598834010,
     &                 -0.2726945493839470,
     &                  0.1799511605347720,
     &                 -0.4711182545950220,
     &                  0.2945924443337410,
     &                 -0.7712530320946440,
     &                  0.713923598834010,
     &                 -0.2726945493839470,
     &                  0.1799511605347720,
     &                 -0.4711182545950220 /)
          W(1:L) = (/   0.334521439965580,  ! Weights
     &                  0.0879113877046390,
     &                  0.1676280391064690,
     &                  0.3058748159137350,
     &                  0.0879113877046390,
     &                  0.0879113877046390,
     &                  0.1676280391064690,
     &                  0.1676280391064690,
     &                  0.3058748159137350,
     &                  0.3058748159137350,
     &                  0.0879113877046390,
     &                  0.0879113877046390,
     &                  0.1676280391064690,
     &                  0.1676280391064690,
     &                  0.3058748159137350,
     &                  0.3058748159137350 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN                                  ! Ref [5]*
C-----------------------------------------------------------------------
          L = 5
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,4,4,4,4 /)
          A(1:L) = (/ 0.00000000000000000000,
     &                0.96884996636197772072,
     &                0.75027709997890053354,
     &                0.52373582021442933604,
     &                0.07620832819261717318 /)
          B(1:L) = (/ 0.00000000000000000000,
     &                0.63068011973166885417,
     &                0.92796164595956966740,
     &                0.45333982113564719076,
     &                0.85261572933366230775 /)
          W(1:L) = (/ 0.52674897119341563786,
     &                0.08887937817019870697,
     &                0.11209960212959648528,
     &                0.39828243926207009528,
     &                0.26905133763978080301/)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.10) THEN                                 ! Ref []
C-----------------------------------------------------------------------
          L = 22
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = 1
          A(1:L) = (/  4.7324898849276598e-01,
     &                -3.5072672608918981e-01,
     &                -4.7113921490701688e-01,
     &                 3.2110023120386515e-02,
     &                 1.0733227865108741e-01,
     &                 8.1037492260191812e-01,
     &                -7.7882541598318511e-01,
     &                -6.4763548426267536e-01,
     &                 3.9247487539609610e-01,
     &                 7.6050655071397388e-01,
     &                -8.1171510601648733e-01,
     &                -1.1429517364223797e-01,
     &                 7.5296563247996007e-01,
     &                -6.2402437958984702e-01,
     &                -2.0650134619887220e-01,
     &                 5.0891319042960681e-01,
     &                -9.8171192640479688e-01,
     &                -9.4061855719921172e-01,
     &                -9.2254816825741193e-01,
     &                 9.5380192234255112e-01,
     &                 9.6634208368735852e-01,
     &                 9.5774959160007522e-01  /)
          B(1:L) = (/  1.6557852510038315e-01,
     &                 1.8447172062121983e-01,
     &                -6.6664733059821124e-01,
     &                -3.1879357593640706e-01,
     &                 6.1886619139299248e-01,
     &                 6.1159678303492504e-01,
     &                -2.1052738914821550e-01,
     &                 6.4749469817525440e-01,
     &                -7.6311149392438349e-01,
     &                -3.6631391678067937e-01,
     &                -9.2466842429053542e-01,
     &                -9.4921913140887015e-01,
     &                -9.7071837396777472e-01,
     &                 9.8538331193146012e-01,
     &                 9.1195887103573425e-01,
     &                 9.2152907557898267e-01,
     &                -6.2586619353239670e-01,
     &                 3.1884535968392919e-01,
     &                 8.7923480439903223e-01,
     &                -7.5512692061435549e-01,
     &                 1.0431232556636386e-01,
     &                 9.2621050012583894e-01 /)
          W(1:L) = (/  3.7171764930896173e-01,
     &                 3.8811447402440874e-01,
     &                 2.8395842218278933e-01,
     &                 4.0824197726154576e-01,
     &                 3.1498878221231136e-01,
     &                 2.0018320620277513e-01,
     &                 2.6587113477126029e-01,
     &                 2.3057004553370086e-01,
     &                 2.5827939410342804e-01,
     &                 2.6042397681916851e-01,
     &                 8.8686202216975499e-02,
     &                 1.1861767207465973e-01,
     &                 5.9110195150351146e-02,
     &                 3.3387129247073037e-02,
     &                 1.3460977386198075e-01,
     &                 1.3337731192240113e-01,
     &                 6.3269272761110995e-02,
     &                 1.1984158532391266e-01,
     &                 6.2537941187552140e-02,
     &                 7.1805898760516657e-02,
     &                 9.7940429484131938e-02,
     &                 3.4467525588983812e-02 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN                                 ! Ref [5]*
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4 /)
          A(1:L) = (/ 0.98263922354085547295e+00,
     &                0.82577583590296393730e+00,
     &                0.18858613871864195460e+00,
     &                0.81252054830481310049e+00,
     &                0.52532025036454776234e+00,
     &                0.41658071912022368274e-01 /)
          B(1:L) = (/ 0.69807610454956756478e+00,
     &                0.93948638281673690721e+00,
     &                0.95353952820153201585e+00,
     &                0.31562343291525419599e+00,
     &                0.71200191307533630655e+00,
     &                0.42484724884866925062e+00 /)
          W(1:L) = (/ 0.48020763350723814563e-01,
     &                0.66071329164550595674e-01,
     &                0.97386777358668164196e-01,
     &                0.21173634999894860050e+00,
     &                0.22562606172886338740e+00,
     &                0.35115871839824543766e+00 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.12) THEN                                 ! Ref [ ]
C-----------------------------------------------------------------------
          L = 31
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = 1
          A(1:L) = (/ -3.8131119459148788e-01,
     &                 6.4573191109453948e-02,
     &                -1.0834321329194775e-02,
     &                -3.1882703020851938e-01,
     &                 4.9124051440092803e-01,
     &                -2.0906799447670715e-01,
     &                 1.8948337189272124e-01,
     &                -6.9740094114568829e-01,
     &                -5.8402513589553640e-01,
     &                 4.4701377237977313e-01,
     &                 3.4867912208378016e-01,
     &                -8.2562697914640848e-01,
     &                 8.2839794669248942e-02,
     &                -4.0351974647584699e-01,
     &                 6.5401042056406233e-01,
     &                -9.0264377285460362e-01,
     &                -8.5295397551927077e-01,
     &                 8.2216786295901656e-01,
     &                 7.4510555770497011e-01,
     &                -9.4133986362315170e-01,
     &                -5.4461187387612175e-01,
     &                 7.4407322966908984e-01,
     &                -7.2254885481492603e-01,
     &                 6.7524406569352735e-01,
     &                 9.3807676975195520e-01,
     &                -9.9171408764710778e-01,
     &                -9.7391149358748841e-01,
     &                -9.2231295237113653e-01,
     &                 9.5557708019583965e-01,
     &                 9.8216591295043421e-01,
     &                 9.2557212335129857e-01  /)
          B(1:L) = (/ -1.5398000784199919e-01,
     &                -4.9794871568657245e-01,
     &                 1.2224478971657705e-01,
     &                -7.3294898893865745e-01,
     &                -7.8409257688727241e-01,
     &                 6.5611051497298534e-01,
     &                 8.9911805536738287e-01,
     &                -4.2248127033807525e-01,
     &                 3.3100645378716304e-01,
     &                -2.2659664973677845e-01,
     &                 4.3860404955163790e-01,
     &                -7.8339223275580994e-01,
     &                -9.4230798695085749e-01,
     &                 9.6482881096343187e-01,
     &                 7.3857098028675039e-01,
     &                -1.5881852211379360e-02,
     &                 4.0163251602231481e-01,
     &                -5.2660748692256265e-01,
     &                 1.0988549815212308e-01,
     &                -9.5414148142964417e-01,
     &                -9.5530036379122441e-01,
     &                -9.7744835460673618e-01,
     &                 7.9662230649630528e-01,
     &                 9.9626110485909680e-01,
     &                 8.8729244026658205e-01,
     &                -5.2853945477454323e-01,
     &                 5.9955340548238656e-01,
     &                 9.5082592343728289e-01,
     &                -8.4903353418547223e-01,
     &                -1.6369711363774472e-01,
     &                 4.7425880434330858e-01  /)
          W(1:L) = (/  2.3598701292933691e-01,
     &                 2.4110813600847844e-01,
     &                 2.7048224227639595e-01,
     &                 1.8648166880884143e-01,
     &                 1.7241958393889878e-01,
     &                 2.4109442092821515e-01,
     &                 1.4125391453247216e-01,
     &                 1.8292025454973745e-01,
     &                 2.2222997581864359e-01,
     &                 2.4904537785770031e-01,
     &                 2.5112362229462498e-01,
     &                 9.2811359998802967e-02,
     &                 9.8238337173087234e-02,
     &                 6.8583817743889233e-02,
     &                 1.5506938444449642e-01,
     &                 1.3182320881366066e-01,
     &                 6.0068518355283269e-02,
     &                 1.5766018519773284e-01,
     &                 1.9930860602643424e-01,
     &                 2.1719109379092324e-02,
     &                 6.4596098758824216e-02,
     &                 4.0584519909105145e-02,
     &                 1.2603341007939087e-01,
     &                 3.0006912476756006e-02,
     &                 4.4974753329261395e-02,
     &                 3.8721244577288268e-02,
     &                 4.7718056922379071e-02,
     &                 3.0056189691189335e-02,
     &                 4.4499282846528827e-02,
     &                 5.6566093223890265e-02,
     &                 9.6814701109561335e-02  /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN                                 ! Ref [5]
C-----------------------------------------------------------------------
          L = 9
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,4,4,4,4,4,4,4,4 /)
          A(1:L) = (/ 0.00000000000000000000e+00,
     &                0.77880971155441942252e+00,
     &                0.95729769978630736566e+00,
     &                0.13818345986246535375e+00,
     &                0.94132722587292523695e+00,
     &                0.47580862521827590507e+00,
     &                0.75580535657208143627e+00,
     &                0.69625007849174941396e+00,
     &                0.34271655604040678941e+00 /)
          B(1:L) = (/ 0.00000000000000000000e+00,
     &                0.98348668243987226379e+00,
     &                0.85955600564163892859e+00,
     &                0.95892517028753485754e+00,
     &                0.39073621612946100068e+00,
     &                0.85007667369974857597e+00,
     &                0.64782163718701073204e+00,
     &                0.70741508996444936217e-01,
     &                0.40930456169403884330e+00 /)
          W(1:L) = (/ 0.30038211543122536139e+00,
     &                0.29991838864499131666e-01,
     &                0.38174421317083669640e-01,
     &                0.60424923817749980681e-01,
     &                0.77492738533105339358e-01,
     &                0.11884466730059560108e+00,
     &                0.12976355037000271129e+00,
     &                0.21334158145718938943e+00,
     &                0.25687074948196783651e+00 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 11
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 /)     ! Multipl.
          A(1:L) = (/ 0.987984566507718090349221212365420,  ! Pointts
     &                0.908159496006570002120150995477360,
     &                0.679283658334533049913253910033250,
     &                0.509113734117583535147786373595080,
     &                0.976753324669101903523852007980770,
     &                0.756199367191492440120050663659120,
     &                0.897785693286338774800085747826770,
     &                0.205993070742521417294189638736180,
     &                0.451443125112991390175338758865640,
     &                0.666838245383608738340713991296260,
     &                0.74295704755765822553432311307323D-1 /)
          B(1:L) = (/ 0.771268212238755338998869334464850,
     &                0.957031834346906908722371764425980,
     &                0.882601975930872536013444452743350,
     &                0.971203129741836998546923138562260,
     &                0.83559862608781647288448365846813D-1,
     &                0.756199367191492440120050663659120,
     &                0.46676265923796434848237353795400,
     &                0.840794484540785404265621609688830,
     &                0.562456862332199406375400662983770,
     &                0.190466302435717207616796166352430,
     &                0.323977022497530198182518544327520 /)
          W(1:L) = (/ 0.20881470204497523521771058289754D-1, ! Weights
     &                0.25545901574497276542640153395248D-1,
     &                0.31203866624933300871149690867662D-1,
     &                0.38010761595074827467645518285610D-1,
     &                0.41449061852426148002787373214871D-1,
     &                0.79320407004083334044710201039891D-1,
     &                0.88901265758751523303980720079987D-1,
     &                0.120169821582060275078235697130560,
     &                0.168820434106397997541535110146210,
     &                0.169871624973361851604897864400530,
     &                0.215825384723915942020646613149680 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4 /)         ! Multipl.
          A(1:L) = (/ 0.833959144220507625957075203283290,  ! Points
     &                0.967012407603778649589407787761590,
     &                0.98651441086033068583570701960810,
     &                0.17035060808995408160378979789427D-1,
     &                0.425238965224530309410223142525050,
     &                0.881941090892153566243167297687360,
     &                0.699789077190586009123889802273820,
     &                0.908584129588383447977235476172530,
     &                0.739337592052920158066204750857210,
     &                0.212461558378854192893057935530620,
     &                0.156441720958463425143227164379120,
     &                0.503985638194279970448304824225040,
     &                0.582438950744672570784623362570580,
     &                0.289703230655412722125574701081550 /)
          B(1:L) = (/ 0.996901349982582941141697652766880,
     &                0.921015650153696426190857405766580,
     &                0.562517802446672523521530818337150,
     &                0.982049142568430334497124819902610,
     &                0.957964532368651957418998093902620,
     &                0.741176885697325090810612087414470,
     &                0.887280242932557749073499924099980,
     &                0.258431221518207701730223647323470,
     &                0.47295583257297618882242532468520,
     &                0.00000000000000000000000000000000,
     &                0.812592125239123119940617441599530,
     &                0.682010932977925307953708533083590,
     &                0.118465445606478912099274993695790,
     &                0.408769859537943384116433298768360 /)
          W(1:L) = (/ 0.10693483986974526468925667171638D-1, ! Weights
     &                0.16771622989325482379964908559201D-1,
     &                0.21520834803173017585623196363995D-1,
     &                0.24893201532665059892584476318209D-1,
     &                0.42463258472030940473501779894230D-1,
     &                0.53711265037645010830029221647514D-1,
     &                0.54579479693382460849318673206721D-1,
     &                0.67375653622461385504403959336007D-1,
     &                0.98025282885102299426881768287454D-1,
     &                0.98325651584666601742691443856667D-1,
     &                0.105768983196657272002492594687330,
     &                0.105934535745754012834830208183740,
     &                0.14990405484916921950315250394890,
     &                0.150032691600992710505599598538390 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 17
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4 /)   ! Multipl.
          A(1:L) = (/ 0.937909440601746367241643056921480,  ! Points
     &                0.59787966519157168521483636741590,
     &                0.968657817477988344721154278042460,
     &                0.988717132764473306635786707321770,
     &                0.983985341323383866813137962515890,
     &                0.365857759345555860894388618529730,
     &                0.783921491760966023451109341866550,
     &                0.869371448989578752047922776235220,
     &                0.918893777775738010322321999043130,
     &                0.140783968044568486283636875082060,
     &                0.563796668154465265730280974497710,
     &                0.762002742930703276982300618652430,
     &                0.69745388342191267884442122044750,
     &                0.523103923394044943927571827660060,
     &                0.305668369039291913700338384875680,
     &                0.448986426282880827653384945327560,
     &                0.98253418759835132805054567507033D-1  /)
          B(1:L) = (/ 0.999985460728529072602053806526470,
     &                0.987328479417815400870263008389660,
     &                0.898374951635325729649498895430090,
     &                0.622596343895302877671367763936090,
     &                0.81109463487824943619725131193050D-1,
     &                0.964624004228919705160969235535260,
     &                0.937564445443781753182956178608730,
     &                0.743808660345971017652796189189130,
     &                0.384108758227378832606387576494260,
     &                0.879879573079810176585290647866660,
     &                0.818792106076360159293687199282370,
     &                0.157499201227322698080233564101270,
     &                0.546575274601777768473349165724870,
     &                0.00000000000000000000000000000000,
     &                0.650176702706879605492783954288730,
     &                0.342404653806802309459393228370530,
     &                0.235096216291155323253037897855470 /)
          W(1:L) = (/ 0.42157189312457273371400997162954D-2,  ! Weights
     &                0.99237601014741223600089798896376D-2,
     &                0.15078678879581549295330034135223D-1,
     &                0.15121496864822956266676863866018D-1,
     &                0.23821621047339582724750103846036D-1,
     &                0.28746437252189671047629194361029D-1,
     &                0.31348715503861464721826917341708D-1,
     &                0.49762852666717116332578404045926D-1,
     &                0.55534775159604041101829554407116D-1,
     &                0.65013710432173970207381031565964D-1,
     &                0.73819068900731731823980126564345D-1,
     &                0.90385825968150641564727715959435D-1,
     &                0.91881833336425013923433485117405D-1,
     &                0.94967142638856099564605740671378D-1,
     &                0.104981747241028434574674664338260,
     &                0.118713368509280584243474227045560,
     &                0.126683246566517292909952857128670 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 21
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1 /)
          A(1:L) = (/ 0.997428443180714657888521533294460,  ! Points
     &                0.900922057228577150906317702957890,
     &                0.981375816611523226178665830813530,
     &                0.475623988460619216369523600496090,
     &                0.68396217875524370909034162562144D-1,
     &                0.964451711702909740198939286342610,
     &                0.967895340677605409827390741133860,
     &                0.712046261839021443234093455536310,
     &                0.866865035635049337464195096064430,
     &                0.293888957654902558615323129249840,
     &                0.882452897205096465337067830641170,
     &                0.883564655497776302968723908513480,
     &                0.537143303287965915982354772562570,
     &                0.732977372786888490359665075314750,
     &                0.743408158979943893670052510957090,
     &                0.143523798672578628918208691348080,
     &                0.577163748064870343381510016228390,
     &                0.380106531055197457742910453261240,
     &                0.493803047507045672965721500887640,
     &                0.233006942769649198845622487555860,
     &                0.00000000000000000000000000000000 /)
          B(1:L) = (/ 0.523493335403422686773021876981190,
     &                0.992136246111987659840225779261580,
     &                0.935777665005192284426275768031820,
     &                0.988065039814063641670065432050750,
     &                0.982891421213467958945750075520950,
     &                0.730795641927920331982297298403490,
     &                0.284169437040225642515425473843970,
     &                0.950017375773952644228808432445730,
     &                0.857545149044262118186420717703590,
     &                0.91478375374420147743639913929870,
     &                0.78310571319347967606817150072422D-1,
     &                0.506500278197455404466992194812030,
     &                0.82111662321535962574448188332070,
     &                0.678114741579903528819887959831590,
     &                0.258912124059179425029496586133770,
     &                0.737142844448782333877649889740160,
     &                0.426051378322523785016495318239380,
     &                0.591909801960054693889295340148080,
     &                0.46968438389915362845722235027390D-1,
     &                0.278540549928700575941519956252270,
     &                0.00000000000000000000000000000000 /)
          W(1:L) = (/ 0.59245289910274777823163684444026D-2,  ! Weights
     &                0.63181879993530976749052313712955D-2,
     &                0.77654356771885822575525989789117D-2,
     &                0.13313236524649387539261801099149D-1,
     &                0.18028023632000303112294832251383D-1,
     &                0.20759211084811453614957408545828D-1,
     &                0.24345594686962939048122829629801D-1,
     &                0.27291829813157459363923440908365D-1,
     &                0.31313724489320677669626239379042D-1,
     &                0.43028684463625497581941353350492D-1,
     &                0.47435107497760585342967184111271D-1,
     &                0.49535232791099913534195616930148D-1,
     &                0.59086609737522776429493659734483D-1,
     &                0.61598898755573131953283218720393D-1,
     &                0.68662882737105569078247834904061D-1,
     &                0.77511025760449779132628565445376D-1,
     &                0.77655900861398148704502327066780D-1,
     &                0.84165159143253389201574044182295D-1,
     &                0.116643957423565597112264665396210,
     &                0.125870779667014285954003935611380,
     &                0.134983953052639791647747375755710 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.23) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 25
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) =(/4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4/)
          A(1:L) = (/  0.224757764352695878756833475245030,
     &                 0.874207930876896802873869012662290,
     &                 0.976022672613640221974319103918980,
     &                 0.989010257580283470714249409756980,
     &                 0.993269209240316337123139408416250,
     &                 0.564995923166212788169178341659650,
     &                 0.124799332346678095227648850712350,
     &                 0.902404399320343843981175181416610,
     &                 0.966034160999610045578745186751090,
     &                 0.743274033812573793903172090358520,
     &                 0.943971582343373481194799887639740,
     &                 0.364735933238215546711656381176410,
     &                 0.900253092874432754206162855866430,
     &                 0.48034665839500246850252725186282D-1,
     &                 0.549191162143093288713738347548940,
     &                 0.864875376908999699275001003538660,
     &                 0.787696213093480127732021867315990,
     &                 0.576710284209456433943162344763280,
     &                 0.200134082627620447885863200309310,
     &                 0.746027287830323886503544276766950,
     &                 0.641772804586726458482070640780090,
     &                 0.402364113097523973631925555390350,
     &                 0.469939831200515705072681780908480,
     &                 0.22491749438123049571812018957130,
     &                 0.228317533864552762452099477368150 /)
          B(1:L) = (/  0.29562926123440075779470457695520,
     &                 0.991644841702323743299545822522230,
     &                 0.960386443899881492138129164227330,
     &                 0.794761706954390950371251113574240,
     &                 0.452699068266705119985076189892110,
     &                 0.989634439635466808825826235948450,
     &                 0.988916345115731075233172216885550,
     &                 0.866817471658503225026435682361580,
     &                 0.221288379835874505456593912560770,
     &                 0.937392797891401674773964395580060,
     &                 0.627343738112143635630258124718480,
     &                 0.936540535531906870382415241983860,
     &                 0.2507099034142795181 3078348104539D-1,
     &                 0.653046876919900575916240388721490,
     &                 0.00000000000000000000000000000000,
     &                 0.420217007311403876455369245738140,
     &                 0.714861371796371849398633615703480,
     &                 0.826496431062503831897834442603210,
     &                 0.808242673492922093675419996265050,
     &                 0.205819811656463979715566797134720,
     &                 0.515166376877061812905642906859670,
     &                 0.648907818198540939081408180204460,
     &                 0.277147991514298087580230242468030,
     &                 0.403755035172687622106025350239130,
     &                 0.56116790982355323182358196190726D-1 /)
          W(1:L) = (/ -0.22499144590180737573666435988313D-1,
     &                 0.56757797279709720956600059513997D-2,
     &                 0.61294541632385752564605990154598D-2,
     &                 0.77307399716921584473393426863691D-2,
     &                 0.79851030689059360294239183531451D-2,
     &                 0.10747724909071103372536638574027D-1,
     &                 0.14073722901914630236333688287280D-1,
     &                 0.22950166656215871772211451659864D-1,
     &                 0.23104503668552704581666880144042D-1,
     &                 0.24886583460620943481070103801115D-1,
     &                 0.25495608710781325077549951029551D-1,
     &                 0.35148791457392415926700843453924D-1,
     &                 0.39967612471275640012053163262252D-1,
     &                 0.42210906199290840139296408236284D-1,
     &                 0.45629308917602135087674549832202D-1,
     &                 0.47184931543983842485535616621711D-1,
     &                 0.48004360511784007777329600464972D-1,
     &                 0.51407132281965816724265717022986D-1,
     &                 0.54210495031621259406088939636629D-1,
     &                 0.63980226470850872129000560206633D-1,
     &                 0.71999854713967554049756153858067D-1,
     &                 0.74130368424485001536304396403399D-1,
     &                 0.87075597857073455631778823034765D-1,
     &                 0.100800083238107912757643686513520,
     &                 0.111970088231815763559985397938720 /)
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 23 ********  '
          PRINT*,'  ********       for REGION = SQUARE       ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Count up number of quadrature points

        N = 0
        DO I = 1,L
          N = N + M(I)
        ENDDO

C        ALLOCATE ( PTS(N,2), WTS(N) )
C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,L
          IF (M(I).EQ.1) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            J = J + M(I)
          ELSEIF (M(I).EQ.2) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            PTS(J+1,1) = -A(I)
            PTS(J+1,2) = -B(I)
            WTS(J+1)   =  W(I)
            J = J + M(I)
          ELSEIF (M(I).EQ.4) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            PTS(J+1,1) = -B(I)
            PTS(J+1,2) =  A(I)
            WTS(J+1)   =  W(I)
            PTS(J+2,1) = -A(I)
            PTS(J+2,2) = -B(I)
            WTS(J+2)   =  W(I)
            PTS(J+3,1) =  B(I)
            PTS(J+3,2) = -A(I)
            WTS(J+3)   =  W(I)
            J = J + M(I)
          ENDIF
        ENDDO

C-----------------------------------------------------------------------
C                        TRIANGULAR PRISM QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights with all points located inside the
C     triangle (so-called PI rules). Rules marked by * are optimal.  The
C     rest are the best PI rules currently known.
C
C     [1] E.J. Kubatko, "Efficient cubature rules for triangular prisms"
C         in preparation.
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'TRIPRISM') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1 /)
          A(1:L) = (/ -0.33333333333333333330 /)
          B(1:L) = (/ -0.33333333333333333330 /)
          C(1:L) = (/  0.0000000000000000000 /)
          W(1:L) = (/  4.0000000000000000000 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 4
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1, 1, 1, 1 /)
          A(1:L) = (/  0.244016935856290,
     &                -0.910683602522960,
     &                -0.333333333333330,
     &                -0.333333333333330 /)
          B(1:L) = (/ -0.333333333333330,
     &                 0.244016935856290,
     &                -0.910683602522960,
     &                -0.910683602522960 /)
          C(1:L) = (/  0.00000000000000,
     &                 0.00000000000000,
     &                 1.00000000000000,
     &                -1.00000000000000 /)
          W(1:L) = (/  1.333333333333330,
     &                 1.333333333333330,
     &                 0.666666666666670,
     &                 0.666666666666670 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 4  ********  '
          PRINT*,'  ********       for REGION = SQUARE       ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Count up number of quadrature points

        N = 0
        DO I = 1,L
          N = N + M(I)
        ENDDO
C        ALLOCATE ( PTS(N,3), WTS(N) )

C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,N
          IF (M(I).EQ.1) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            PTS(J,3)   =  C(I)
            WTS(J)     =  W(I)
            J = J + M(I)
          ENDIF
        ENDDO
C-----------------------------------------------------------------------
      ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ********  ERROR!!! REGION must be EDGE,  ********  '
          PRINT*,'  ********  TRIANGLE, SQUARE OR TRIPRISM   ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
      ENDIF
      RETURN
      END SUBROUTINE QUADRATURE
